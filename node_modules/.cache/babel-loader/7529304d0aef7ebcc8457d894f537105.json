{"ast":null,"code":"import * as React from 'react';\nimport { first, startWith } from 'rxjs/operators';\nimport { ObservablePromiseCache } from './requestCache';\nvar requestCache = new ObservablePromiseCache();\nexport function preloadRequest(getPromise, requestId) {\n  var request = requestCache.createDedupedRequest(getPromise, requestId);\n  return {\n    requestId: requestId,\n    request: request\n  };\n}\nexport function preloadObservable(observable$, observableId) {\n  return preloadRequest(function () {\n    return observable$.pipe(first()).toPromise();\n  }, observableId);\n}\nexport function usePreloadedRequest(preloadResult) {\n  var request = requestCache.getRequest(preloadResult.requestId);\n\n  if (!request.isComplete) {\n    throw request.promise;\n  }\n\n  if (request.error) {\n    throw request.error;\n  }\n\n  return request.value;\n}\nexport function useObservable(observable$, observableId, startWithValue) {\n  if (!observableId) {\n    throw new Error('cannot call useObservable without an observableId');\n  }\n\n  var result = preloadObservable(observable$, observableId);\n  var initialValue = startWithValue;\n\n  if (initialValue === undefined) {\n    initialValue = usePreloadedRequest(result);\n  }\n\n  var _a = React.useState(initialValue),\n      latestValue = _a[0],\n      setValue = _a[1];\n\n  React.useEffect(function () {\n    var subscription = observable$.pipe(startWith(initialValue)).subscribe(function (newVal) {\n      result.request.setValue(newVal);\n      setValue(newVal);\n    }, function (error) {\n      console.error('There was an error', error);\n      throw error;\n    });\n    return function () {\n      subscription.unsubscribe();\n      requestCache.removeRequest(observableId);\n    };\n  }, [observableId]);\n  return latestValue;\n}","map":{"version":3,"sources":["C:/Users/Juan Pablo/Desktop/firebase-react-byte/node_modules/reactfire/useObservable/index.js"],"names":["React","first","startWith","ObservablePromiseCache","requestCache","preloadRequest","getPromise","requestId","request","createDedupedRequest","preloadObservable","observable$","observableId","pipe","toPromise","usePreloadedRequest","preloadResult","getRequest","isComplete","promise","error","value","useObservable","startWithValue","Error","result","initialValue","undefined","_a","useState","latestValue","setValue","useEffect","subscription","subscribe","newVal","console","unsubscribe","removeRequest"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,KAAT,EAAgBC,SAAhB,QAAiC,gBAAjC;AACA,SAASC,sBAAT,QAAuC,gBAAvC;AACA,IAAIC,YAAY,GAAG,IAAID,sBAAJ,EAAnB;AACA,OAAO,SAASE,cAAT,CAAwBC,UAAxB,EAAoCC,SAApC,EAA+C;AAClD,MAAIC,OAAO,GAAGJ,YAAY,CAACK,oBAAb,CAAkCH,UAAlC,EAA8CC,SAA9C,CAAd;AACA,SAAO;AACHA,IAAAA,SAAS,EAAEA,SADR;AAEHC,IAAAA,OAAO,EAAEA;AAFN,GAAP;AAIH;AACD,OAAO,SAASE,iBAAT,CAA2BC,WAA3B,EAAwCC,YAAxC,EAAsD;AACzD,SAAOP,cAAc,CAAC,YAAY;AAAE,WAAOM,WAAW,CAACE,IAAZ,CAAiBZ,KAAK,EAAtB,EAA0Ba,SAA1B,EAAP;AAA+C,GAA9D,EAAgEF,YAAhE,CAArB;AACH;AACD,OAAO,SAASG,mBAAT,CAA6BC,aAA7B,EAA4C;AAC/C,MAAIR,OAAO,GAAGJ,YAAY,CAACa,UAAb,CAAwBD,aAAa,CAACT,SAAtC,CAAd;;AACA,MAAI,CAACC,OAAO,CAACU,UAAb,EAAyB;AACrB,UAAMV,OAAO,CAACW,OAAd;AACH;;AACD,MAAIX,OAAO,CAACY,KAAZ,EAAmB;AACf,UAAMZ,OAAO,CAACY,KAAd;AACH;;AACD,SAAOZ,OAAO,CAACa,KAAf;AACH;AACD,OAAO,SAASC,aAAT,CAAuBX,WAAvB,EAAoCC,YAApC,EAAkDW,cAAlD,EAAkE;AACrE,MAAI,CAACX,YAAL,EAAmB;AACf,UAAM,IAAIY,KAAJ,CAAU,mDAAV,CAAN;AACH;;AACD,MAAIC,MAAM,GAAGf,iBAAiB,CAACC,WAAD,EAAcC,YAAd,CAA9B;AACA,MAAIc,YAAY,GAAGH,cAAnB;;AACA,MAAIG,YAAY,KAAKC,SAArB,EAAgC;AAC5BD,IAAAA,YAAY,GAAGX,mBAAmB,CAACU,MAAD,CAAlC;AACH;;AACD,MAAIG,EAAE,GAAG5B,KAAK,CAAC6B,QAAN,CAAeH,YAAf,CAAT;AAAA,MAAuCI,WAAW,GAAGF,EAAE,CAAC,CAAD,CAAvD;AAAA,MAA4DG,QAAQ,GAAGH,EAAE,CAAC,CAAD,CAAzE;;AACA5B,EAAAA,KAAK,CAACgC,SAAN,CAAgB,YAAY;AACxB,QAAIC,YAAY,GAAGtB,WAAW,CAACE,IAAZ,CAAiBX,SAAS,CAACwB,YAAD,CAA1B,EAA0CQ,SAA1C,CAAoD,UAAUC,MAAV,EAAkB;AACrFV,MAAAA,MAAM,CAACjB,OAAP,CAAeuB,QAAf,CAAwBI,MAAxB;AACAJ,MAAAA,QAAQ,CAACI,MAAD,CAAR;AACH,KAHkB,EAGhB,UAAUf,KAAV,EAAiB;AAChBgB,MAAAA,OAAO,CAAChB,KAAR,CAAc,oBAAd,EAAoCA,KAApC;AACA,YAAMA,KAAN;AACH,KANkB,CAAnB;AAOA,WAAO,YAAY;AACfa,MAAAA,YAAY,CAACI,WAAb;AACAjC,MAAAA,YAAY,CAACkC,aAAb,CAA2B1B,YAA3B;AACH,KAHD;AAIH,GAZD,EAYG,CAACA,YAAD,CAZH;AAaA,SAAOkB,WAAP;AACH","sourcesContent":["import * as React from 'react';\nimport { first, startWith } from 'rxjs/operators';\nimport { ObservablePromiseCache } from './requestCache';\nvar requestCache = new ObservablePromiseCache();\nexport function preloadRequest(getPromise, requestId) {\n    var request = requestCache.createDedupedRequest(getPromise, requestId);\n    return {\n        requestId: requestId,\n        request: request\n    };\n}\nexport function preloadObservable(observable$, observableId) {\n    return preloadRequest(function () { return observable$.pipe(first()).toPromise(); }, observableId);\n}\nexport function usePreloadedRequest(preloadResult) {\n    var request = requestCache.getRequest(preloadResult.requestId);\n    if (!request.isComplete) {\n        throw request.promise;\n    }\n    if (request.error) {\n        throw request.error;\n    }\n    return request.value;\n}\nexport function useObservable(observable$, observableId, startWithValue) {\n    if (!observableId) {\n        throw new Error('cannot call useObservable without an observableId');\n    }\n    var result = preloadObservable(observable$, observableId);\n    var initialValue = startWithValue;\n    if (initialValue === undefined) {\n        initialValue = usePreloadedRequest(result);\n    }\n    var _a = React.useState(initialValue), latestValue = _a[0], setValue = _a[1];\n    React.useEffect(function () {\n        var subscription = observable$.pipe(startWith(initialValue)).subscribe(function (newVal) {\n            result.request.setValue(newVal);\n            setValue(newVal);\n        }, function (error) {\n            console.error('There was an error', error);\n            throw error;\n        });\n        return function () {\n            subscription.unsubscribe();\n            requestCache.removeRequest(observableId);\n        };\n    }, [observableId]);\n    return latestValue;\n}\n"]},"metadata":{},"sourceType":"module"}